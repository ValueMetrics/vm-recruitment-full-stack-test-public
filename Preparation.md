# ValueMetrics Full-Stack Recruitment Case - Preparation
## Introduction
Here at ValueMetrics, we work a lot with real-estate data. Clients upload their data using our upload tools and are subsequently able to inspect their data using our dashboards and data reports.

This repository will be the basis for the recruitment case. It consists of a Vue 3 frontend with Pinia stores. You can already familiarize yourself with the stores and their functions. Together with the Pinia documentation, you should be able to understand what kind of business logic we have implemented there.

The backend is a Node.js application and uses Express as routing solution. It holds three services: the excel-generator service, the mssql-recordset-streaming service, and the mssql-database connection service.

The mssql-database-connection service is responsible for connecting the backend to the MSSQL database. The mssql-recordset-streaming service is responsible for transforming datastreams from the database, so they can work with the excel generator. Finally, the excel-generatir service holds the logic that enables the creation of excel files from the datastreams generated by the mssql-recordset-streaming service. In this document, we will explain how an excel file is generated using this backend in more detail.

## Technical background
To generate a report, the layout configuration, the expected worksheets (for some clients the report contains different sheets compared to others) and the report data [is requested from the database](https://github.com/ValueMetrics/vm-recruitment-full-stack-test-public/blob/main/backend/src/controllers/datareport-controller.ts#L24). These three pieces of information are used to generate the report. In addition, helper functions [generate a list of recordset id’s](https://github.com/ValueMetrics/vm-recruitment-full-stack-test-public/blob/main/backend/src/services/excel-generator/excel-generator.controller.ts#L35) from the layout configuration.

The data is [retrieved from the database in a node Readable stream](https://github.com/ValueMetrics/vm-recruitment-full-stack-test-public/blob/main/backend/src/controllers/datareport-controller.ts#L69). This Readable stream returns the report data row by row, in order of the sheets of the report. We use the first transformer in the pipeline ([MSSQLFingerprintCreator](https://github.com/ValueMetrics/vm-recruitment-full-stack-test-public/blob/main/backend/src/services/mssql-recordset-streaming/mssql-recordset-streaming.transformers.ts#L6)) to create fingerprints of every row of the Readable stream. A fingerprint is simply a string generated by merging all column names. If a fingerprint changes from one row to another, the Readable stream is said to return data of a new recordset, which defines a new Excel worksheet.

The second transformer ([MSSQLRowTransformer](https://github.com/ValueMetrics/vm-recruitment-full-stack-test-public/blob/main/backend/src/services/mssql-recordset-streaming/mssql-recordset-streaming.transformers.ts#L26)) takes the [recordset id’s as input](https://github.com/ValueMetrics/vm-recruitment-full-stack-test-public/blob/main/backend/src/services/excel-generator/excel-generator.controller.ts#L43). With every incoming row, it checks the row fingerprint, and sends the data along with the correct recordset id through the pipeline. If the fingerprint of an incoming data row changes, [it will switch to a next recordset id](https://github.com/ValueMetrics/vm-recruitment-full-stack-test-public/blob/main/backend/src/services/mssql-recordset-streaming/mssql-recordset-streaming.transformers.ts#L65) and [sends this new id together with the data row](https://github.com/ValueMetrics/vm-recruitment-full-stack-test-public/blob/main/backend/src/services/mssql-recordset-streaming/mssql-recordset-streaming.transformers.ts#L67).

The final transformer ([ReportExcelTransformer](https://github.com/ValueMetrics/vm-recruitment-full-stack-test-public/blob/main/backend/src/services/excel-generator/excel-generator.transformers.ts#L11)) takes the [layout configuration and output file path](https://github.com/ValueMetrics/vm-recruitment-full-stack-test-public/blob/main/backend/src/services/excel-generator/excel-generator.controller.ts#L44) as input and processes the incoming data row into an Excel file. For every row, the recordset id is used to find the correct sheet to commit the data to. If it is the first row of a new sheet, [a new worksheet is generated using the correct layout configuration](https://github.com/ValueMetrics/vm-recruitment-full-stack-test-public/blob/main/backend/src/services/excel-generator/excel-generator.transformers.ts#L78), and the data is committed to this sheet. If the first row of a new sheet does not contain data, the sheet is empty, [and the creation of this sheet is skipped](https://github.com/ValueMetrics/vm-recruitment-full-stack-test-public/blob/main/backend/src/services/excel-generator/excel-generator.transformers.ts#L111). When all the data and sheets are processed and generated, the workbook is stored on the specified location if a file path is configured as input to this transformer. If this file path is not used as input to the transformer, the transformer will pipe the chunks through the stream.

## Useful documentation

- [Vue3](https://vuejs.org)
- [Pinia](https://pinia.vuejs.org)
- [TailwindCSS](https://tailwindcss.com)
- [Node](https://nodejs.org)
- [Express](https://expressjs.com)
- [Node Streams](https://nodejs.org/api/stream.html)
- [ExcelJS](https://github.com/exceljs/exceljs)
- [Node-MSSQL](https://github.com/tediousjs/node-mssql)

\
\
**Happy coding and good luck!**
